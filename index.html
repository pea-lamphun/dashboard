<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á PEA ‡∏•‡∏≥‡∏û‡∏π‡∏ô</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Sarabun', 'Noto Sans Thai', Arial, sans-serif;
            background: #f5f7fa;
        }

        /* Login Screen */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #6B2C91 0%, #4A1C6C 100%);
        }

        .login-box {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            width: 400px;
            max-width: 90%;
        }

        .login-box img {
            width: 100px;
            display: block;
            margin: 0 auto 20px;
        }

        .login-box h2 {
            text-align: center;
            color: #2d3748;
            margin-bottom: 30px;
        }

        .login-box input {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
        }

        .login-box button {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #6B2C91 0%, #4A1C6C 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            cursor: pointer;
            font-weight: 600;
        }

        .login-box button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(107, 44, 145, 0.4);
        }

        .error-message {
            color: #e53e3e;
            text-align: center;
            margin-top: 10px;
            display: none;
        }

        /* Dashboard */
        .dashboard {
            display: none;
        }

        .header {
            background: white;
            padding: 20px 40px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header img {
            width: 60px;
        }

        .header h1 {
            font-size: 24px;
            color: #2d3748;
        }

        .logout-btn {
            padding: 10px 20px;
            background: #e53e3e;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        .container {
            max-width: 1400px;
            margin: 30px auto;
            padding: 0 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .stat-card h3 {
            color: #718096;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .stat-card .number {
            font-size: 36px;
            font-weight: bold;
            color: #2d3748;
        }

        .filters {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .filters h3 {
            margin-bottom: 15px;
            color: #2d3748;
        }

        .filter-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .filter-row input,
        .filter-row select {
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            font-size: 14px;
        }

        .filter-row button {
            padding: 10px 20px;
            background: #6B2C91;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab {
            padding: 12px 24px;
            background: white;
            border: none;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            font-size: 16px;
            color: #718096;
        }

        .tab.active {
            background: #6B2C91;
            color: white;
        }

        .table-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: #f7fafc;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: #2d3748;
            border-bottom: 2px solid #e2e8f0;
        }

        td {
            padding: 12px;
            border-bottom: 1px solid #e2e8f0;
        }

        tr:hover {
            background: #f7fafc;
        }

        .action-btn {
            padding: 6px 12px;
            margin: 2px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .btn-view {
            background: #3498db;
            color: white;
        }

        .btn-delete {
            background: #e74c3c;
            color: white;
        }

        .loading {
            text-align: center;
            padding: 60px 40px;
            color: #2d3748;
        }

        .loading-spinner {
            display: inline-block;
            width: 50px;
            height: 50px;
            border: 5px solid #e2e8f0;
            border-top: 5px solid #6B2C91;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 18px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 10px;
        }

        .loading-subtext {
            font-size: 14px;
            color: #718096;
            font-style: italic;
        }

        .status-dropdown {
            padding: 6px 10px;
            border: 1px solid #cbd5e0;
            border-radius: 4px;
            background: white;
            cursor: pointer;
            font-size: 13px;
        }

        /* ‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏ñ‡∏ß */
        tr.status-processing {
            background-color: #FFF9C4 !important;
        }

        tr.status-completed {
            background-color: #E8F5E9 !important;
        }

        tr.status-pending {
            background-color: #FFFFFF !important;
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginContainer" class="login-container">
        <div class="login-box">
            <img src="https://i.ibb.co/svLGKgCX/logo-3.png" alt="PEA Logo">
            <h2>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö Dashboard</h2>
            <input type="password" id="passwordInput" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" onkeypress="if(event.key==='Enter') login()">
            <button onclick="login()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
            <div class="error-message" id="errorMessage">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</div>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" class="dashboard">
        <div class="header">
            <div class="header-left">
                <img src="https://i.ibb.co/svLGKgCX/logo-3.png" alt="PEA Logo">
                <h1>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á PEA ‡∏•‡∏≥‡∏û‡∏π‡∏ô</h1>
            </div>
            <button class="logout-btn" onclick="logout()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
        </div>

        <div class="container">
            <!-- Statistics -->
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
                    <div class="number" id="totalRequests">0</div>
                </div>
                <div class="stat-card">
                    <h3>‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</h3>
                    <div class="number" id="pendingRequests">0</div>
                </div>
                <div class="stat-card">
                    <h3>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</h3>
                    <div class="number" id="processingRequests">0</div>
                </div>
                <div class="stat-card">
                    <h3>‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</h3>
                    <div class="number" id="completedRequests">0</div>
                </div>
            </div>

            <!-- Filters -->
            <div class="filters">
                <h3>üîç ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
                <div class="filter-row">
                    <input type="date" id="startDate" placeholder="‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô">
                    <input type="date" id="endDate" placeholder="‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î">
                    <select id="statusFilter">
                        <option value="">‡∏ó‡∏∏‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</option>
                        <option value="‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£">‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</option>
                        <option value="‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</option>
                        <option value="‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô">‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</option>
                        <option value="‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö">‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</option>
                    </select>
                    <input type="text" id="searchText" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ (‡∏ä‡∏∑‡πà‡∏≠, ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£, ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á)">
                    <button onclick="applyFilters()">üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
                </div>
            </div>

            <!-- Tabs -->
            <div class="tabs">
                <button class="tab active" onclick="switchTab('service')">‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</button>
                <button class="tab" onclick="switchTab('payment')">‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</button>
            </div>

            <!-- Table -->
            <div class="table-container">
                <div id="loadingMessage" class="loading">
                    <div class="loading-spinner"></div>
                    <div class="loading-text">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>
                    <div class="loading-subtext">(Google Apps Script ‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤ 2-5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)</div>
                </div>
                <div id="serviceTable" style="display:none;">
                    <table>
                        <thead>
                            <tr>
                                <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà-‡πÄ‡∏ß‡∏•‡∏≤</th>
                                <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
                                <th>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
                                <th>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</th>
                                <th>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á</th>
                                <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                <th>‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                            </tr>
                        </thead>
                        <tbody id="serviceTableBody">
                        </tbody>
                    </table>
                </div>
                <div id="paymentTable" style="display:none;">
                    <table>
                        <thead>
                            <tr>
                                <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà-‡πÄ‡∏ß‡∏•‡∏≤</th>
                                <th>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
                                <th>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</th>
                                <th>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á</th>
                                <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                <th>‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                            </tr>
                        </thead>
                        <tbody id="paymentTableBody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ‚ö†Ô∏è ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏•‡∏∞ URL ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
        const ADMIN_PASSWORD = 'pea123';
        const DELETE_PASSWORD = 'admin123';
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwsxI-3YqXUFfnsvM4eYvBZUNzgs1wcUHBK8aot3LVLeQeiTxthRliJ9c17TJNQPUht/exec';
        
        let currentTab = 'service';
        let allServiceData = [];
        let allPaymentData = [];
        let filteredServiceData = [];
        let filteredPaymentData = [];

        function login() {
            const password = document.getElementById('passwordInput').value;
            if (password === ADMIN_PASSWORD) {
                document.getElementById('loginContainer').style.display = 'none';
                document.getElementById('dashboard').style.display = 'block';
                loadData();
            } else {
                document.getElementById('errorMessage').style.display = 'block';
            }
        }

        function logout() {
            document.getElementById('loginContainer').style.display = 'flex';
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('passwordInput').value = '';
        }

        async function loadData() {
            try {
                document.getElementById('loadingMessage').style.display = 'block';
                document.getElementById('serviceTable').style.display = 'none';
                document.getElementById('paymentTable').style.display = 'none';

                const url = `${GOOGLE_SCRIPT_URL}?action=getData&password=${ADMIN_PASSWORD}`;
                const response = await fetch(url);
                const result = await response.json();

                if (result.status === 'success') {
                    // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà‡∏Ç‡∏∂‡πâ‡∏ô‡∏ö‡∏ô‡∏™‡∏∏‡∏î (reverse)
                    allServiceData = (result.data.serviceRequests || []).reverse();
                    allPaymentData = (result.data.paymentRequests || []).reverse();
                    
                    filteredServiceData = allServiceData;
                    filteredPaymentData = allPaymentData;
                    
                    updateStats();
                    displayData();
                    
                    document.getElementById('loadingMessage').style.display = 'none';
                    if (currentTab === 'service') {
                        document.getElementById('serviceTable').style.display = 'block';
                    } else {
                        document.getElementById('paymentTable').style.display = 'block';
                    }
                } else {
                    alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ: ' + result.message);
                }
            } catch (error) {
                console.error('Error loading data:', error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
            }
        }

        function updateStats() {
            const total = allServiceData.length;
            const pending = allServiceData.filter(r => r['‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞'] === '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£').length;
            const processing = allServiceData.filter(r => r['‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞'] === '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£').length;
            const completed = allServiceData.filter(r => r['‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞'] === '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô').length;

            document.getElementById('totalRequests').textContent = total;
            document.getElementById('pendingRequests').textContent = pending;
            document.getElementById('processingRequests').textContent = processing;
            document.getElementById('completedRequests').textContent = completed;
        }

        function displayData() {
            displayServiceRequests();
            displayPaymentRequests();
        }

        function displayServiceRequests() {
            const tbody = document.getElementById('serviceTableBody');
            tbody.innerHTML = '';

            filteredServiceData.forEach(request => {
                const row = document.createElement('tr');
                
                // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î class ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á
                if (request['‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞'] === '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô') {
                    row.classList.add('status-completed');
                } else if (request['‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞'] === '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£') {
                    row.classList.add('status-processing');
                } else {
                    row.classList.add('status-pending');
                }

                row.innerHTML = `
                    <td>${request['‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà-‡πÄ‡∏ß‡∏•‡∏≤']}</td>
                    <td>${request['‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á']}</td>
                    <td>${request['‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•']}</td>
                    <td>${request['‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£']}</td>
                    <td>${request['‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á']}</td>
                    <td>
                        <select class="status-dropdown" onchange="changeStatus('service', ${request._rowIndex}, this.value)">
                            <option value="‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£" ${request['‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞'] === '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£' ? 'selected' : ''}>‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</option>
                            <option value="‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£" ${request['‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞'] === '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£' ? 'selected' : ''}>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</option>
                            <option value="‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô" ${request['‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞'] === '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô' ? 'selected' : ''}>‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</option>
                        </select>
                    </td>
                    <td>
                        <button class="action-btn btn-view" onclick="window.open('${request['‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå']}', '_blank')">
                            üìÇ ‡∏î‡∏π‡πÑ‡∏ü‡∏•‡πå
                        </button>
                        <button class="action-btn btn-delete" onclick="deleteRequest('service', ${request._rowIndex})">
                            üóëÔ∏è ‡∏•‡∏ö
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function displayPaymentRequests() {
            const tbody = document.getElementById('paymentTableBody');
            tbody.innerHTML = '';

            filteredPaymentData.forEach(request => {
                const row = document.createElement('tr');
                
                // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î class ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á
                if (request['‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞'] === '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô') {
                    row.classList.add('status-completed');
                } else {
                    row.classList.add('status-pending');
                }

                row.innerHTML = `
                    <td>${request['‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà-‡πÄ‡∏ß‡∏•‡∏≤']}</td>
                    <td>${request['‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•']}</td>
                    <td>${request['‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£']}</td>
                    <td>${request['‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á']}</td>
                    <td>
                        <select class="status-dropdown" onchange="changeStatus('payment', ${request._rowIndex}, this.value)">
                            <option value="‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö" ${request['‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞'] === '‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö' ? 'selected' : ''}>‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</option>
                            <option value="‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô" ${request['‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞'] === '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô' ? 'selected' : ''}>‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</option>
                        </select>
                    </td>
                    <td>
                        <button class="action-btn btn-view" onclick="window.open('${request['‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå']}', '_blank')">
                            üìÇ ‡∏î‡∏π‡πÑ‡∏ü‡∏•‡πå
                        </button>
                        <button class="action-btn btn-delete" onclick="deleteRequest('payment', ${request._rowIndex})">
                            üóëÔ∏è ‡∏•‡∏ö
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        async function changeStatus(sheetType, rowIndex, newStatus) {
            try {
                const url = `${GOOGLE_SCRIPT_URL}?action=updateStatus&password=${ADMIN_PASSWORD}&sheetType=${sheetType}&rowIndex=${rowIndex}&newStatus=${encodeURIComponent(newStatus)}`;
                const response = await fetch(url);
                const result = await response.json();

                if (result.status === 'success') {
                    // ‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                    await loadData();
                } else {
                    alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÑ‡∏î‡πâ: ' + result.message);
                }
            } catch (error) {
                console.error('Error updating status:', error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
            }
        }

        async function deleteRequest(sheetType, rowIndex) {
            const password = prompt('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö\n‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô:');
            
            if (!password) {
                return; // ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
            }

            if (password !== DELETE_PASSWORD) {
                alert('‚ùå ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
                return;
            }

            if (!confirm('‚ùå ‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ?\n‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏î‡πâ!')) {
                return;
            }

            try {
                const url = `${GOOGLE_SCRIPT_URL}?action=deleteRow&password=${ADMIN_PASSWORD}&deletePassword=${password}&sheetType=${sheetType}&rowIndex=${rowIndex}`;
                const response = await fetch(url);
                const result = await response.json();

                if (result.status === 'success') {
                    alert('‚úÖ ‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
                    await loadData();
                } else {
                    alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡πÑ‡∏î‡πâ: ' + result.message);
                }
            } catch (error) {
                console.error('Error deleting:', error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
            }
        }

        function switchTab(tab) {
            currentTab = tab;
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');

            if (tab === 'service') {
                document.getElementById('serviceTable').style.display = 'block';
                document.getElementById('paymentTable').style.display = 'none';
            } else {
                document.getElementById('serviceTable').style.display = 'none';
                document.getElementById('paymentTable').style.display = 'block';
            }
        }

        function applyFilters() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            const status = document.getElementById('statusFilter').value;
            const searchText = document.getElementById('searchText').value.toLowerCase();

            filteredServiceData = allServiceData.filter(request => {
                let match = true;

                if (status && request['‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞'] !== status) {
                    match = false;
                }

                if (searchText) {
                    const searchableText = `${request['‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•']} ${request['‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£']} ${request['‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á']}`.toLowerCase();
                    if (!searchableText.includes(searchText)) {
                        match = false;
                    }
                }

                return match;
            });

            filteredPaymentData = allPaymentData.filter(request => {
                let match = true;

                if (status && request['‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞'] !== status) {
                    match = false;
                }

                if (searchText) {
                    const searchableText = `${request['‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•']} ${request['‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£']} ${request['‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á']}`.toLowerCase();
                    if (!searchableText.includes(searchText)) {
                        match = false;
                    }
                }

                return match;
            });

            displayData();
        }
    </script>
</body>
</html>
